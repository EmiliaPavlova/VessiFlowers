DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'VessiFlowers.Data.Repositories.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201802082028492_InitializeDatabase'
BEGIN
    IF schema_id('vf') IS NULL
        EXECUTE('CREATE SCHEMA [vf]')
    CREATE TABLE [vf].[Gallery] (
        [Id] [int] NOT NULL IDENTITY,
        [GalleryTypeId] [int] NOT NULL,
        [Title] [nvarchar](128) NOT NULL,
        [Position] [int] NOT NULL,
        [Content] [nvarchar](max),
        [Created] [datetime] NOT NULL,
        [Duration] [nvarchar](256),
        [Price] [nvarchar](256),
        CONSTRAINT [PK_vf.Gallery] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_GalleryTypeId] ON [vf].[Gallery]([GalleryTypeId])
    CREATE TABLE [vf].[GalleryType] (
        [Id] [int] NOT NULL IDENTITY,
        [Keyword] [nvarchar](128) NOT NULL,
        [Name] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_vf.GalleryType] PRIMARY KEY ([Id])
    )
    CREATE TABLE [vf].[Medias] (
        [Id] [int] NOT NULL IDENTITY,
        [GalleryId] [int],
        [Url] [nvarchar](128) NOT NULL,
        [DataSize] [nvarchar](16) NOT NULL,
        [PostId] [int],
        [IsPalette] [bit] NOT NULL,
        CONSTRAINT [PK_vf.Medias] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_GalleryId] ON [vf].[Medias]([GalleryId])
    CREATE INDEX [IX_PostId] ON [vf].[Medias]([PostId])
    CREATE TABLE [vf].[Posts] (
        [Id] [int] NOT NULL IDENTITY,
        [Created] [datetime] NOT NULL,
        [Title] [nvarchar](128) NOT NULL,
        [UserId] [nvarchar](128) NOT NULL,
        [Content] [nvarchar](max) NOT NULL,
        [IsActive] [bit] NOT NULL,
        CONSTRAINT [PK_vf.Posts] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserId] ON [vf].[Posts]([UserId])
    CREATE TABLE [dbo].[AspNetUsers] (
        [Id] [nvarchar](128) NOT NULL,
        [Domain] [nvarchar](128) NOT NULL,
        [Email] [nvarchar](256),
        [EmailConfirmed] [bit] NOT NULL,
        [PasswordHash] [nvarchar](max),
        [SecurityStamp] [nvarchar](max),
        [PhoneNumber] [nvarchar](max),
        [PhoneNumberConfirmed] [bit] NOT NULL,
        [TwoFactorEnabled] [bit] NOT NULL,
        [LockoutEndDateUtc] [datetime],
        [LockoutEnabled] [bit] NOT NULL,
        [AccessFailedCount] [int] NOT NULL,
        [UserName] [nvarchar](256) NOT NULL,
		[FullName] [nvarchar](256),
        [IsSubscribed] [bit] NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [UserNameIndex] ON [dbo].[AspNetUsers]([UserName])
    CREATE TABLE [dbo].[AspNetUserClaims] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [nvarchar](128) NOT NULL,
        [ClaimType] [nvarchar](max),
        [ClaimValue] [nvarchar](max),
        CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserClaims]([UserId])
    CREATE TABLE [dbo].[AspNetUserLogins] (
        [LoginProvider] [nvarchar](128) NOT NULL,
        [ProviderKey] [nvarchar](128) NOT NULL,
        [UserId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY ([LoginProvider], [ProviderKey], [UserId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserLogins]([UserId])
    CREATE TABLE [dbo].[AspNetUserRoles] (
        [UserId] [nvarchar](128) NOT NULL,
        [RoleId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY ([UserId], [RoleId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserRoles]([UserId])
    CREATE INDEX [IX_RoleId] ON [dbo].[AspNetUserRoles]([RoleId])
    CREATE TABLE [vf].[Pages] (
        [Id] [int] NOT NULL IDENTITY,
        [Keyword] [nvarchar](128) NOT NULL,
        [Title] [nvarchar](128) NOT NULL,
        [Content] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_vf.Pages] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[AspNetRoles] (
        [Id] [nvarchar](128) NOT NULL,
        [Name] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [RoleNameIndex] ON [dbo].[AspNetRoles]([Name])
    CREATE TABLE [vf].[Slugs] (
        [Id] [int] NOT NULL IDENTITY,
        [Url] [nvarchar](255) NOT NULL,
        [Controller] [nvarchar](64) NOT NULL,
        [Action] [nvarchar](64),
        [Param] [int],
        CONSTRAINT [PK_vf.Slugs] PRIMARY KEY ([Id])
    )
    ALTER TABLE [vf].[Gallery] ADD CONSTRAINT [FK_vf.Gallery_vf.GalleryType_GalleryTypeId] FOREIGN KEY ([GalleryTypeId]) REFERENCES [vf].[GalleryType] ([Id]) ON DELETE CASCADE
    ALTER TABLE [vf].[Medias] ADD CONSTRAINT [FK_vf.Medias_vf.Posts_PostId] FOREIGN KEY ([PostId]) REFERENCES [vf].[Posts] ([Id]) ON DELETE CASCADE
    ALTER TABLE [vf].[Medias] ADD CONSTRAINT [FK_vf.Medias_vf.Gallery_GalleryId] FOREIGN KEY ([GalleryId]) REFERENCES [vf].[Gallery] ([Id]) ON DELETE CASCADE
    ALTER TABLE [vf].[Posts] ADD CONSTRAINT [FK_vf.Posts_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserClaims] ADD CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserLogins] ADD CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201802082028492_InitializeDatabase', N'VessiFlowers.Data.Repositories.Migrations.Configuration',  0x1F8B0800000000000400ED5DDD6EDCB815BE2FD07710E6AA2DBC1EC7DE046960EF22EBC45BA37162649CA077012DD163211A69563F8EDD629FAC177DA4BE42499192F82B9112258DDD2040E0E1CFE139E4E121CF21F5F1BFFFFECFF1CFF79BC8BB83691626F1C9E2D9FEC1C283B19F0461BC3E5914F9CD0F2F173FFFF4C73F1CBF0D36F7DEE7AADC112E876AC6D9C9E236CFB7AF96CBCCBF851B90ED6F423F4DB2E426DFF793CD1204C9F2F0E0E0AFCB67CF96109158205A9E77FCB188F37003CB1FE8E76912FB709B1720BA48021865341DE5AC4AAADE7BB081D916F8F064F1196659781625DF102FFB6F400EF63FC26D9285799286305B78AFA31020AE5630BA5978208E931CE488E7579F32B8CAD3245EAFB6280144570F5B88CADD8028835496574D7153B10E0EB158CBA66245CA2FB23CD958127C7644FB692956EFD5DB8BBA1F514FBE453D9E3F60A9CBDE3C59FC0AA208A60F0B4F6CEBD56994E272AABE2EA9A07EDEA7B5F73C7D99BD5A5F905AE17F7BDE6911E5450A4F6258E42988F6BCCBE23A0AFDBFC387ABE42B8C4FE2228A58AE11DF288F4B40499769B28569FEF011DE5059CE8385B7E4EB2DC58A7535A60E11F33CCE8F0E17DE7BD438B88E60AD144C97AC907AC15F610C5390C3E012E4394C634C0396DD2AB52EB4457B0B37D7DD6C3BA9AB308F60450269349AA80BEF02DCBF83F13ABF4553F8F0E5C23B0BEF6150A550B29FE210CD6B54294F0B68DDEC259E62A5220E611E4DF41CF5580BFBE84F23F63BDA49211EA7AA1DA496F00AD91B6B7EDF142960A556307CF8FC8503862FD3D06F1BD59EADBC0777E1BA9440AF900BEF238CCA32D96DB82596739FC9FF42FE2E8DEB599A6C3E26114FA029F0E50AA46B888737692BB54A8AD4B760F60206C8A6B7F1F9A52A22314873EA3605CEAAEC8A7196A5E36563334D2C29E9CC21D61497FB6E518D2C2AE2E55B9206D31B42FCFF04AD76CCDC7236BA9BB79AD9A199DDBD264939D17A4E8FB2EEF78961B3D5909A6CAFF5298DA69F4A780857E13F5BA793D9B267BF99C92D3BE83CBB0411446351D5FA25413305C48367F2C3B0754DB3E28ACB9E294FB867940CE10C05374CB2C40A9BA7E2C3D87410A67A590E5CF5BBE130321CAEF6CC333928C8BF4FCF67D80FB873692C1B3ECF5EFB7978E7D020B5ECB30DA6BFB887509906534EF0602AF9C0195F30658E8D265532424CD6201B4438EA658370D527618326DC19A04E0EDBBCEE91DA3D43C53B36F86EFCFDF36C555C677E1A5E3716D778020BB4DEA2BE6ADBBDB9E1B86C0519BB9B30DD0CE7F9126419F6DFFE06B2DBD1A3412BE817299ACEAB1C6CB6A3B776799BC4F07DB1B9C60663BAB69C0DCDD5B7E40CF8682FF136C6B506D37B97F85F93227F1B07784BF129F7E51D86210127ECBCF67D6489CF9032C3E034299A95BB5F44131B774716A3F7BA7D1A8170A35EB7CBE5AFCA17164C922CADDB6C9EEDBAFD2E5987710B2755BEC00949567342F36C39A17B843E5B08251BFCEEC2940B4CA0850B9A2D7051A6AAB9205983E230953B80E995A3DCB6ABB9A88F975E67DBF730DFAF6A93CDCBC3598A68223BFE755F22BBE719576E364087A61BA0A367D737472F9FBF00C1D18B1FE1D1F3A7E890CDE6D1E0E123C1ECB18F69704B9F4154B86EAAD76C282D8DFBD95092DDFDD950B28992EFC2006F5C96DD35AAC288BC51F94A9F6DE79CC0D9E4279FAC984F33AAD16BBAE0B5C8FD6CC154777FB2A8555959140BD447EBE7B2FE15BF3BA2719760DDF75015577D127197277C9A3A53B078A2A0ADB55D756F531F873D7D2C71C9B93D7DBC28A8FD4976BCBFD0628D5F29E74AFEA5A2C8203F731515EB9E861B57FD6EB8CD7CC4D673FBC3E7CFC7B29E6982CF995BDA7EF1E3184DE323AFD6EB7886CD7645A7913D6CB91EA09B04AFB32CF1C37260E5AB61CC7D1CBEF1B771E0195DCE21320BD77C90F448F7C32DD276C411B27C0B51AB3FC46F600473E891CE43E307321F04722F20A9023BD6EAD336893591ADBF48ADA1490653ACE5001F2B6468DA86712ECFC830F6C32D884C7A48A86C38A1B1E0753362CE1BB885319E8B26DD60D2BE70135866A56E51189BAEEE3A5E32DAD7AE94EC61AE6EBC9527BBCD28932B19FC101FECEF8FA47CCA5B260D33F46AD9280AA7E88709D44C21B049ABD5BDA659B48A3D6AD00DA4F2DCA1194872C83E893D539D72309C28A2E4A3A897A24326502F85F026AD6AA31E93A9173D3F6A1D54F130693EF5128EAE34EA45C3CEE3A917DF2153A9172FFCE3502F722AD83AA6C211E17CCA255C776A5F9A5DAA13D70353691327EDE3502672B8DB3A86C249EF7CCAC49F2B6B0C15094E8DA7585C6F4CA5589CE43BAF58C2B5F00E67AD65FFAEF1D2C6DBC2EBAEAD4FB38B5777C874FE628FBD3CF31DC72CAAA60828EAC6B62DBA289B1295191949E95A629AD3DB387D2F4DA087FA9E30695C7D86398A2292C01A8E30A21A30A50CB0B1E0F2ECE65EF54108928B8697331AE7131503D35EC15CFE94AE89E78906726942A3ACD9428604EA3A4855D7EB2522D4327654A757DAA4DA643FD851999E184895C946A4A3B2E42CAB28293C6A0BB2D5C5C156B2D493B2204B2FE0B5522526A1ABF3C15A49881C5F7754EEE2C288037C68A22242CE6184CACCE453AA32FBED2853B6F52353D1369886B56B41C4C924591BD368B4443194C97106081535E81FEE1B18B957B451D5CEB82AC32F9DC42DA2AB62A10C818ABFC1D27237876569B5D1BECE781FC32CB53A2DD2AAC2740C0195E571237965703492AB02519DA1287BC985089246F28A5737925315D408AE0891740549ECC5E6631B5DD3A3AFA0D4EC6A0455B8EF5D0EBCBDA0BCDFAD195ECAE760A1C56F8AB586BDDB8A691C4C13C36BE2158E61CF541724E41EE8F27A4CFD1E4602E5F099BA298E54A23AB0AEF7D575DEF192406CD184E3A5068BEBF8026CB761BC66B0B9688AB722C05CA73FACEC51AA3684C6D2E7FA59F402EA96F224451B2A21175F4808E059986639BE26720DF079FF69B0918AA9BC08CDA6AA6A517414E441ACB65B550DFCB7ECB4C84865B587213B6094D4199275835DB8F28E88BC4D926B7A18300D442055DC48394DA26213EB9D497D6DE1C89A25D4719AADA749EFFDB1B46892398D06928A25D3A49A53AAAF03B284EA440B3AD527F41C9D2AD19C4E033BC5126A522DFA88E04A711D4492641AC74B41F1246F5FD2762914C34F1F8BC94537FDEEE757E97AF79E63EADAE3CCB3FA122E4BA24E34A7432E29B24448CACE8CB8767BD17BAC4984C47E9435F546B5A31A1B6A47ABBCF7C75229132C2C4C0DBDC359983AD5CA0AE7A248BA7B282D3DDBC0EB701DDC24EF8CF6EA3CA0DECA5B06E8EC75575D6D1CD575B5B0B958F6AB03384EFB3587722D12395AF21B14165E6FABD49D515B9D33D35B6DCBD0B0BDDAAAAB8DA3B6158C0867E3689A3995061484A5D3A4DA280B8BFAC12B0C9B634E91627FB0A46892250D063E4222C6E459AC0B1CC207B73A7039E61405180F96A49065C1250BD6C131C966F4A2A7E95175090B132AC17370D654CA35A7AC00EA60492BB27BD056F02CE69953556079B08415D976CB8C3CEB9BD49D31EC8A18B8432B2F1FDBD99B7C031AE3D87F475B85060F81DB2C34C996B428E281448CA6EFA466690F3C9C681639B91DA6591A1A7A8BC4A10AF006A9150A414F93830AE0632E2D50097A7A76FABB035AA23B3471A224E531F8301D519318D77C549767582ABA0B35F339B5E5FD05974E2DBEF8D0C3A95556DBED789B0BA7D6D61D9D494D469BDF03E7B6DDBC1EA6363B1F5E2537811C0E527985C87E70D4D546DAE90D8C87B29F348B53B04AB7F14BE4D39B2ACDC6832EBF42E65DE732696255934E8FC52275EB34A5FE5D9F1ED393DBEEE79DA4A35C5264E1555B28A4570F590E37444F57BF45A751581AC9AAC00588C31B98E5E4C3FFC5E1C1B343E155A8DD79A169996501874BA07FA6891FAE09C00B42DCA99DF00496DFEF2B1F422A5B926EF39EC701BC3F59FCABACF9CA3BFFC717AEF29EF72145A3FDCA3BF07E1F063B13DF81D4BF05A90C2032F08DA452AE61C834156F7FDA80FB3FB3C47ABC8214A01FB98B5790941D56629FD8F1C73D7AD48F68AF377A9EC65412309B9C6931D9CD0C226AF928CCD3180FE9E1154BB3A63769267389018271A609E2FB2C6AC22FFAD8C9DCBE9B48AD217D24BDE1721D761968BB374A9E8622BB5A36C65964795CC486AC810691AABC060DE4C674B9EEF5A28743F5944F5DA7504F7796887B0FC21959F1B907571B1BD5EB0EDD8329D3E15E7670C59CFA21873EECA91E7118B461553ED43088A2E2310657F49C74A1EEB1853EB4B40F2DA82CB889B0EA8717FAB0A67D74A18F8B243EB960BE065435CBE43DEF3CFB1487BF1528E30AF586B01A0833CB156AB2E2FCF3D16E14766C291661EB87F9CE1234BD0539A7F0F375E7FDFE7F00EBEE2E1623A3B63F892DA84BA8F6619A353906FADC06864746B7E286549D62D8E503D447BBBC8C15E01AC72F1DE009F683097FBCDE5CBFCD1B167A86CD9B7C8AF9682754578CB0848B1E8C05AD248D619907413D1B50B54676169C0FF37D9C439CE7DD80759E07C1794200AE2787CD3C231A33852362DA1F1B80790A45D17D42A870901E03CAF25C70920A98278691296195A784556BBB1D6FE139ED128EF22E28100D896814686CE0E4A9154877097E1715A81B29792EFD315A1C1F999618AF81F32B4637EAF12E18161210D3D89591718EA7362B9AABD53BA63C76C8C6F362194FBB01B6F16026DB033F5274E25D01249ED306757C72B11BB66876C46119524C1C537A5D5EB8A6DD82244C6EB29F2CEE6ED0B09390530F94E12E90617D2BAA6F55D520C47A0C6205750D429F48986CC324BA245941560DF5285225FB07892A49AEA806D7494D96BC7FA98467ECC6353683356E6F560353DAD63675745ADBA665DADBD60085B6B54D0C516BD3A4487BCB6AC04249474AB4645947CA64958E10D46543713A44E912C34C0402B72C354292152250D86681EA6CF8CC3A38668525566CCAE4BAF2EA381FECB28424DB2A14670819B0B0E1023943569610675B05D25A330D468323415D0029F71794339D1AC80047820EC74DB613D348A5E7C346EE3F66AC9D567FC13F5C48F758C826D66F22033332D4B1726C54E332C9085B401BCB1FA122B7A188F1D558F2EB0DCCC27543E218D18CA1CF390C7599F3F826A9FC1681A3AA8870F67C017310206FE2759A8737C0CF5136BE155BBE605CDE34C477B3AF61701E7F28F26D912391E1E63AE2B408FB3F6DED97F8CD3CCFC71FB6E55BE12E44406C86F836F187F897228C829AEF33C5050B0D09EC58D13B0D782C737CB761FD50537A9FC4868468F7D5FEE015DC6C23442CFB10AF00FE88C29E37A47EEFE01AF80FCDB5441D91EE81E0BBFDF84D08D629D8649446531FFD443A1C6CEE7FFA1FEA6D4F1390A70000 , N'6.2.0-61023')
END
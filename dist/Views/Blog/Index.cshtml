@model BlogViewModel

@{
    ViewBag.Title = "Блог";
}

@if (Model.Subscriber != null)
{
    using (Html.BeginForm("Subscribe", "Blog", FormMethod.Post))
    {
        @Html.AntiForgeryToken()

        <div class="form-horizontal">

            <div class="form-group">
                @Html.LabelFor(model => model.Subscriber.Email, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-7">
                    @Html.TextBoxFor(model => model.Subscriber.Email, new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.Subscriber.Email, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-offset-4 col-md-7">
                    <input type="submit" value="Абонирай се" class="btn btn-primary" />
                </div>
            </div>
        </div>
    }
}

@foreach (var post in Model.Posts)
{
    string imageUrl = "/images/no_image";
    if (post.Images.Count > 0)
    {
        var thumbElements = post.Images.First().Url.Split('/');
        imageUrl = string.Format("/{0}/thumbs/{1}", thumbElements[1], thumbElements[2]);
    }

    <div class="row">
        <div class="col-md-4 text-center">
            <img src="@imageUrl" class="img-responsive" alt="@post.Title">
        </div>
        <div class="col-md-8">
            <h3 class="margin-top-0">@post.Title <br><small class="font-xs"><i>Публикувано на @post.Created.ToShortDateString() от @post.Author</i></small></h3>
            <p>
                @Html.Raw(post.Content.ToFixedLenght(350))
            </p>
            @Html.ActionLink("Виж още", "Post", "Blog", new { id = post.Id }, new { @class = "btn btn-primary", target = "_blank" })
        </div>
    </div>
            <hr>
}
@if (ViewBag.Pager != null)
{
    @Html.Partial("_Pager", (Pager)ViewBag.Pager)
}

@section scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
